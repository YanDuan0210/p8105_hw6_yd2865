p8105_hw6_yd2865
================
Yan Duan
2025-11-29

I’m an R Markdown document!

## Problem 1

``` r
homicide_data = read_csv("./homicide-data.csv")
```

    ## Rows: 52179 Columns: 12
    ## ── Column specification ────────────────────────────────────────────────────────
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## ℹ Use `spec()` to retrieve the full column specification for this data.
    ## ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.

#### (1)

``` r
# tidy the dataset
homicides_clean =
  homicide_data |>
  mutate(
    city_state = str_c(city, state, sep = ", "),
    solved = if_else(disposition == "Closed by arrest", 1L, 0L),
    victim_age = na_if(victim_age, "Unknown"),
    victim_age = as.numeric(victim_age)) |>
  filter(!city_state %in% c(
      "Dallas, TX",
      "Phoenix, AZ",
      "Kansas City, MO",
      "Tulsa, AL"
    )
  ) |>
  filter(victim_race %in% c("White", "Black")) |>
  drop_na(solved, victim_age, victim_sex, victim_race)
```

#### (2)

``` r
# Baltimore data only
baltimore_df =
  homicides_clean |>
  filter(city_state == "Baltimore, MD")

# use the glm function
baltimore_glm =
  glm(
    solved ~ victim_age + victim_sex + victim_race,
    data   = baltimore_df,
    family = binomial)

# OR + CI for male vs. female
baltimore_or =
  broom::tidy(
    baltimore_glm,
    conf.int   = TRUE,
    exponentiate = TRUE) |>
  filter(term == "victim_sexMale") |>
  select(estimate, conf.low, conf.high, p.value)

baltimore_or
```

    ## # A tibble: 1 × 4
    ##   estimate conf.low conf.high  p.value
    ##      <dbl>    <dbl>     <dbl>    <dbl>
    ## 1    0.426    0.324     0.558 6.26e-10

The estimate of the adjusted OR is **0.426** and the confidence interval
is (**0.324**, **0.558**)

#### (3)

``` r
# run glm for each of the cities 
city_or =
  homicides_clean |>
  group_by(city_state) |>
  nest() |>
  mutate(
    model = purrr::map(
      data,
      ~ suppressWarnings(
          glm(
            solved ~ victim_age + victim_sex + victim_race,
            data   = .x,
            family = binomial
          )
      )
    ),
    tidy = purrr::map(     # OR + CI
      model,
      ~ suppressWarnings(
          broom::tidy(
            .x,
            conf.int = TRUE,
            exponentiate = TRUE)
      )
    )
  ) |>
  select(city_state, tidy) |>
  filter(!map_lgl(tidy, is.null)) |> 
  unnest(tidy) |>
  filter(term == "victim_sexMale") |>
  mutate(
    city_state = fct_inorder(city_state)
  ) |> 
  select(city_state, estimate, p.value, conf.low, conf.high)

city_or
```

    ## # A tibble: 47 × 5
    ## # Groups:   city_state [47]
    ##    city_state      estimate   p.value conf.low conf.high
    ##    <fct>              <dbl>     <dbl>    <dbl>     <dbl>
    ##  1 Albuquerque, NM    1.77  1.39 e- 1    0.825     3.76 
    ##  2 Atlanta, GA        1.00  1.000e+ 0    0.680     1.46 
    ##  3 Baltimore, MD      0.426 6.26 e-10    0.324     0.558
    ##  4 Baton Rouge, LA    0.381 1.65 e- 3    0.204     0.684
    ##  5 Birmingham, AL     0.870 5.11 e- 1    0.571     1.31 
    ##  6 Boston, MA         0.674 2.26 e- 1    0.353     1.28 
    ##  7 Buffalo, NY        0.521 2.90 e- 2    0.288     0.936
    ##  8 Charlotte, NC      0.884 6.00 e- 1    0.551     1.39 
    ##  9 Chicago, IL        0.410 1.86 e-18    0.336     0.501
    ## 10 Cincinnati, OH     0.400 6.49 e- 4    0.231     0.667
    ## # ℹ 37 more rows

#### (4)

``` r
# Create a plot shows the estimated ORs and CIs for each city
ggplot(city_or,
       aes(x = city_state, y = estimate)) +
  geom_hline(yintercept = 1, linetype = "dashed") +
  geom_point() +
  geom_errorbar(
    aes(ymin = conf.low, ymax = conf.high), width = 0
  ) +
  coord_flip() +
  labs(
    x = "City",
    y = "Adjusted odds ratio (Male vs Female)",
    title = "Adjusted ORs for solving homicides: male vs female victims"
  )
```

![](p8105_hw6_yd2865_files/figure-gfm/unnamed-chunk-5-1.png)<!-- -->

The plot shows adjusted odds ratios for solving homicides (male vs
female victims) by city, ordered from lowest to highest OR. In most
cities the OR is below 1, meaning that, after adjusting for age and
race, cases with male victims are less likely to be solved than cases
with female victims. In several cities (for example Baltimore, Baton
Rouge, Birmingham and a few others near the bottom of the plot), the
entire 95% confidence interval falls below 1. Only a few cities have ORs
near or above 1, and those estimates tend to have wide confidence
intervals, so evidence of any advantage for male victims is weak.
